# Copyright (c) Microsoft Corporation.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

trigger: none
pr: none
schedules:
  - cron: '0 16 * * Mon,Wed,Fri'
    displayName: Sync from upstream three times a week
    branches:
      include:
        - microsoft/main
    always: true

variables:
  - group: Microsoft-GoLang-bot

jobs:
  - job: Sync
    pool:
      vmImage: ubuntu-20.04
    workspace:
      clean: all
    steps:
      - template: /eng/pipeline/steps/checkout-unix-task.yml
      - template: /eng/pipeline/steps/init-pwsh-task.yml

      # Initialize stage 0 toolset ahead of time so we can track timing data separately from the
      # build operations. When we call this script again later, it won't download Go again.
      - pwsh: |
          . eng/utilities.ps1
          Get-Stage0GoRoot
        displayName: Init stage 0 Go toolset

      - pwsh: |
          git config --global user.name 'microsoft-golang-bot'
          git config --global user.email 'microsoft-golang-bot@users.noreply.github.com'

          eng/run.ps1 sync `
            -origin https://microsoft-golang-bot:$(BotAccount-microsoft-golang-bot-PAT)@github.com/microsoft/go `
            -to https://microsoft-golang-bot:$(BotAccount-microsoft-golang-bot-PAT)@github.com/microsoft-golang-bot/go `
            -github-pat $(BotAccount-microsoft-golang-bot-PAT) `
            -github-pat-reviewer $(BotAccount-microsoft-golang-review-bot-PAT) `
            -b release-branch.go1.15 `
            -b release-branch.go1.16 `
            -b release-branch.go1.17 `
            -b master
        displayName: Sync
